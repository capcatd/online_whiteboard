FROM mhart/alpine-node:14.15

WORKDIR /app

COPY package*.json ./

RUN npm ci --only=production

COPY . .

ARG API_URL
ARG WS_URL
ARG FRONTEND_URL

ENV NEXT_PUBLIC_API_HOST ${API_URL}
ENV NEXT_PUBLIC_WS_HOST ${WS_URL}
ENV NEXT_PUBLIC_FRONTEND_HOST ${FRONTEND_URL}

RUN npm run build

ARG FRONTEND_PORT
ENV FRONTEND_PORT ${FRONTEND_PORT}

CMD npm run start ${FRONTEND_PORT}